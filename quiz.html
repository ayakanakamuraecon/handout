<!-- クイズ機能スクリプト -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  // 入力ボックス .fill-in の値を復元・保存
  document.querySelectorAll('.fill-in').forEach(input => {
    const key = "fillin-" + input.id;
    input.value = localStorage.getItem(key) || "";
    input.addEventListener('input', () => {
      localStorage.setItem(key, input.value);
    });
  });

  // テキストエリア .quiz-answer の値を復元（oninput 属性から key を抽出）
  document.querySelectorAll('.quiz-answer').forEach(textarea => {
    const key = textarea.getAttribute("oninput")?.match(/'([^']+)'/)?.[1];
    if (key) {
      textarea.value = localStorage.getItem(key) || "";
    }

    // 入力イベントを明示的に設定（安全のため）
    textarea.addEventListener('input', () => {
      if (key) localStorage.setItem(key, textarea.value);
    });
  });

  // 全削除ボタンの処理
  const clearButton = document.getElementById("clear-answers");
  if (clearButton) {
    clearButton.addEventListener("click", () => {
      const confirmed = confirm("本当にすべての回答を削除しますか？");
      if (!confirmed) return;

      document.querySelectorAll(".fill-in").forEach(input => {
        const key = "fillin-" + input.id;
        localStorage.removeItem(key);
        input.value = "";
      });

      document.querySelectorAll(".quiz-answer").forEach(textarea => {
        const k = textarea.getAttribute("oninput")?.match(/'([^']+)'/)?.[1];
        if (k) {
          localStorage.removeItem(k);
        }
        textarea.value = "";
      });

      alert("すべての回答を削除しました");
    });
  }
});

// 解答表示切替ボタン
function showAnswer(id) {
  const answerDiv = document.getElementById(id);
  if (!answerDiv) return;
  answerDiv.style.display = (answerDiv.style.display === "none") ? "block" : "none";
}
</script>

<!-- 全削除ボタン -->
<div id="quiz-tools" style="margin: 2em 0;">
  <button id="clear-answers">全問クリア</button>
</div>

<!-- スタイル -->
<style>
#quiz-tools button {
  font-size: 1em;
  padding: 0.5em 1em;
  margin-right: 1em;
  border: none;
  background-color: #557a95;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}
#quiz-tools button:hover {
  background-color: #416175;
}
.fill-in {
  min-width: 8em;
  font-size: 1em;
  font-family: sans-serif;
  padding: 0.3em;
  margin: 0 0.3em;
}
.quizbox {
  background-color: #f0f4f8;
  border-left: 4px solid #9db4c0;
  padding: 1em;
  margin: 1.5em 0;
  border-radius: 6px;
}
.quiz-answer {
  width: 100%;
  min-height: 5em;
  margin-top: 0.5em;
  font-family: sans-serif;
  font-size: 1em;
  padding: 0.5em;
}
.answer {
  background-color: #eef5fa;
  padding: 0.5em;
  border-radius: 4px;
}
</style>
