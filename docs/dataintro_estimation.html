<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>推測統計（編集中）</title>
    <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.min.css">
    <link rel="stylesheet" href="customcss.css">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <nav id="TOC">
        <ul>
        <li><a href="#推測統計編集中"
        id="toc-推測統計編集中">推測統計（編集中）</a></li>
        <li><a href="#推測統計とは"
        id="toc-推測統計とは">推測統計とは？</a>
        <ul>
        <li><a href="#サンプリングと標本の代表性"
        id="toc-サンプリングと標本の代表性">サンプリングと標本の代表性</a></li>
        <li><a href="#標準誤差" id="toc-標準誤差">標準誤差</a></li>
        </ul></li>
        <li><a href="#仮説検定-1" id="toc-仮説検定-1">仮説検定</a></li>
        <li><a href="#回帰分析" id="toc-回帰分析">回帰分析</a>
        <ul>
        <li><a href="#ノンパラメトリック回帰"
        id="toc-ノンパラメトリック回帰">ノンパラメトリック回帰</a></li>
        <li><a href="#線形回帰" id="toc-線形回帰">線形回帰</a></li>
        </ul></li>
        <li><a href="#因果推論" id="toc-因果推論">因果推論</a>
        <ul>
        <li><a href="#因果関係とは"
        id="toc-因果関係とは">因果関係とは</a></li>
        <li><a href="#相関と因果の違い"
        id="toc-相関と因果の違い">相関と因果の違い</a></li>
        </ul></li>
        </ul>
    </nav>
    <main>
        <h1 id="推測統計編集中">推測統計（編集中）</h1>
        <p>この章では、手元のデータが調査したい対象（<strong>母集団</strong>）全体の情報を含んでいないときに、<strong>手元のデータから母集団の特徴や性質を推測する方法</strong>を学びます。</p>
        <p>このことを<strong>推測統計</strong>といいます。</p>
        <p>まずは、推測統計とは何か？を理解してから、具体的な手法を学んでいきましょう。</p>
        <p>データはこれまで通り、<a
        href="dataintro_intro.html">はじめに</a>で説明している<strong>学食の売り上げデータ</strong>を使っていきます。それぞれの変数が何を表しているのかなどは、そちらを参照してください。</p>
        <p>ちなみに、この章の内容を深く理解するためには確率の知識が必要不可欠です。この文章では実践に重きを置いているため確率には触れていませんが、統計学入門の復習をしたり、より詳しく理解したい方は<a
        href="dataintro_book.html">推薦図書</a>に挙げているような『コア・テキスト
        統計学』や『統計学入門』といった、学部中級レベルの統計の教科書を読んでみるとよいでしょう。</p>
        <h1 id="推測統計とは">推測統計とは？</h1>
        <details>
        <summary>
        推測統計とは？セクションを見る（クリックで開閉）
        </summary>
        <p>そもそもデータ分析をする理由に立ち返ってみます。当たり前ですが、<strong>データ分析の目的は、データを使って何かしらの問題を解決したり、現状を改善したりすること</strong>です。</p>
        <p>私たちは、現在<strong>学食の売上向上プロジェクト</strong>に参加しています。学食の売上向上という目標のためには、キャンペーンを打ち出すのが良いのか、広告を出すのが良いのか、営業時間を変更するのが良いのか、頻繁に新メニューを開発するのが良いのか、そして、それぞれの施策はどれほど売上向上に寄与するのか、を知りたいのです。</p>
        <p>そのためには、<strong>母集団の情報を知る必要があります</strong>。学食の売上向上プロジェクトにおいては、学食を利用する可能性があるすべての人の情報です。母集団全体の情報を知ることができれば、例えば、実際に広告を出したときにどの程度売り上げが変化したのかを測ることができます。</p>
        <p><strong>母集団のすべての対象を調査すること</strong>を<strong>全数調査</strong>と呼びます。</p>
        <p>しかし、現実には<strong>母集団全体の情報を手に入れられるケースはほとんどありません</strong>。そこで、多くの場合、<strong>母集団から適切に抽出（サンプリング）した標本（データ）を用いて、母集団の情報を推測しよう</strong>とします。</p>
        <p>このように、<strong>標本から母集団の情報を推測すること</strong>を<strong>推測統計</strong>と言います。</p>
        <p>推測統計には、大きく分けて<strong>統計的推定</strong>と<strong>仮説検定</strong>の2つの方法があります。</p>
        <h4 id="統計的推定">統計的推定</h4>
        <p><strong>母集団の統計量</strong>（平均や分散など）<strong>を、データから統計的に推測すること</strong>を指します。</p>
        <p>例えば、</p>
        <ul>
        <li>手元のデータでは1回あたりの売り上げ平均が500円だったので、母集団の1回あたりの売り上げ平均も500円だろうと推測する。</li>
        <li>手元のデータでは購入者の男性割合が <span
        class="math inline">\(55\%\)</span>
        だったので、母集団の男性割合は <span class="math inline">\(54
        \sim 56\%\)</span> だろうと推測する。</li>
        </ul>
        <p>こういった推測が統計的推定です。</p>
        <p>推定には、<strong>1つの値で推定する点推定</strong>と、<strong>ある程度の幅をもって推定する区間推定</strong>があります。</p>
        <h4 id="仮説検定">仮説検定</h4>
        <p><strong>母集団に関する仮説が成り立つか否かを、統計的な手続きを踏んで、データから判断すること</strong>を指します。</p>
        <p>例えば、</p>
        <ul>
        <li>木曜日より火曜日の方が売り上げが大きいかどうか</li>
        <li>ある広告を出すことによって売り上げが変化するかどうか</li>
        </ul>
        <p>こういった仮説を検証する手続きが仮説検定です。</p>
        <h2
        id="サンプリングと標本の代表性">サンプリングと標本の代表性</h2>
        <p>推定をするにしても、仮説検定をするにしても、<strong>標本が母集団の情報を正しく反映している（標本に代表性がある）かどうかが重要</strong>なポイントになります。</p>
        <p>この重要性は、代表性がないケースを想像すると分かりやすいでしょう。</p>
        <p>例えば、学食を利用する可能性があるすべての人を母集団として想定しているにもかかわらず、手元には経済学部の教員の購入データしかないとします。</p>
        <p>学食は主に学生が利用することが多いでしょうから、母集団の平均年齢を推定したいときに、手元のデータの平均年齢を母集団の平均年齢と見なすことはできません。</p>
        <p>また、学生の行動は時間割に左右されていて、ほとんどの学生が昼休みに学食を利用するのに対し、教員は混雑を避けて昼休み前後に利用時間をずらす傾向があるかもしれません。この場合、手元のデータの利用時間のピークを母集団の利用時間のピークとは見なせません。</p>
        <p>さらに、学生と教員では予算にも差があるかもしれません。例えば学生は1食あたり400円以内に収めたいと考えている一方、教員は1食あたり600円までは使って良いと考えているかもしれません。この予算の差は1回あたりの購入金額に表れる可能性があるため、データから得られた平均購入金額を、母集団の平均購入金額と見なすことは難しいでしょう。</p>
        <p>このような誤った推測を避けるために、<strong>標本が代表性をもつようにバランスよくサンプリングする必要</strong>があるのです。</p>
        <p>逆に言うと、標本が代表性をもっていさえすれば、標本平均を母集団の平均だと見なしたり、標本分散を母集団の分散だと見なすことが可能です。</p>
        <p><strong>母集団の情報を推測するために使う数値</strong>（例えば、母集団の平均を推測するために用いるデータの標本平均のこと）<strong>を推定量と呼びます</strong>。</p>
        <h3 id="ランダムサンプリング">ランダムサンプリング</h3>
        <p>標本が代表性をもつようにバランスよくサンプリングする方法が<strong>ランダムサンプリング</strong>（<strong>無作為抽出</strong>）です。</p>
        <p>ランダムサンプリングは、<strong>母集団に含まれる調査対象のそれぞれが、標本として抽出される可能性を等しくしたうえで標本を選ぶ方法</strong>です。</p>
        <p>例えば、学食を利用する可能性があるすべての人に <span
        class="math inline">\(1/100\)</span>
        の確率で当たる（標本として抽出される）くじを引いてもらうようなイメージです。</p>
        <p>ランダムサンプリングを行うことで、母集団の情報をバランス良く反映した標本を作ることができます。</p>
        <p><img src="fig_dataintro_random.png" /></p>
        <p>代表性のある標本を作ることができたら、標本から得られた数値を推定量にすることができます。</p>
        <p>ただし、母集団の情報をすべて集めているわけではない以上、<strong>推定量には必ず誤差が生じます</strong>。<strong>推測をする際には、この誤差も考慮に入れる必要があります</strong>。</p>
        <h2 id="標準誤差">標準誤差</h2>
        <p>母集団の情報を推測する際に用いる<strong>推定量のばらつきを標準誤差（Standard
        error; SE）と呼びます</strong>。</p>
        <p>言い換えると、標準誤差は<strong>推定量の標準偏差</strong>です。一般的には<strong>標本平均の標準偏差</strong>を意味します。</p>
        <p>名前は似ていますが、<strong>標準偏差と標準誤差は別物なので注意</strong>しましょう。</p>
        <p>標準誤差は<strong>推定の精度を表す指標</strong>で、<strong>標準誤差が小さいほど、推定量はばらつきが小さく推定の精度が高い</strong>ことを示します。</p>
        <p>データ<span class="math inline">\((x_{1}, \cdots,
        x_{n})\)</span>を用いた<strong>標準誤差<span
        class="math inline">\(SE\)</span>は</strong>、</p>
        <p><span class="math display">\[
        SE = \frac{s}{\sqrt{n}} =
        \frac{\sqrt{\frac{1}{1-n}\sum_{i=1}^{n}(x_{i} -
        \bar{x})^2}}{\sqrt{n}}
        \]</span></p>
        <p>で求められます。つまり、<strong>不偏分散をサンプルサイズで割ったものの平方根</strong>です。</p>
        <p>不偏分散については、<a
        href="dataintro_descriptive.html#.P関数と.S関数">記述統計（
        <code>.P</code>関数と<code>.S</code>関数）</a>を参照してください。</p>
        <p>式を見て分かるように、<span
        class="math inline">\(SE\)</span>の分母にはサンプルサイズが入っています。<strong>標本のサンプルサイズが大きくなると</strong>標準誤差は小さくなる、つまり、<strong>精度の高い推定ができる</strong>ということです。</p>
        <p>例えば、手元のデータは1万人の母集団からランダムサンプリングしたものであるとし、手元のデータから母集団の平均購入金額を推測するとします。</p>
        <p>ランダムサンプリングを複数回行うケースを考えてみます。1回あたりのサンプルサイズが100人のとき、例えば最初の100人の平均購入金額は500円、2回目の100人の平均購入金額は530円、3回目の100人の平均購入金額は490円と、標本ごとに平均購入金額が大きく異なることもあるでしょう。</p>
        <p>ところが、1回あたりのサンプルサイズが1000人だとすると、例えば最初の1000人の平均購入金額は501円、2回目の1000人の平均購入金額は502円、3回目の1000人の平均購入金額は499円と、標本ごとの平均購入金額はそこまで大きく変わらないと想像できます。</p>
        <p>1回あたりのサンプルサイズが2000人、3000人、…と増えていけば、さらに平均購入金額のばらつきは小さくなっていき、十分大きなサンプルサイズを得ることができれば、母集団の真の平均購入金額をほぼ誤差なく推測することができるようになります。</p>
        <p>これが、サンプルサイズが大きいと精度高く推測できるというイメージです。</p>
        <h3
        id="標準誤差を考慮した棒グラフ">標準誤差を考慮した棒グラフ</h3>
        <p>標準誤差を用いると、手元のデータで得られた統計量の精度はどの程度なのかを知ることができました。</p>
        <p>この推定精度を考慮したグラフを作成することで、より深い洞察が得られる場合があります。</p>
        <p>例えば、男女間で平均購入金額に差があるかを知りたい、気温によってよく購入される商品の違いがあるのかを知りたいなど、特に<strong>グループ間の平均に統計的に差があるかどうかを知りたいとき</strong>にとても有用です。</p>
        <p><img src="fig_dataintro_sebar.png" /></p>
        <p>これは、標準誤差を考慮したうえで男女別に平均購入金額を棒グラフにしたものです。</p>
        <p><strong>棒グラフの高さは、男性、女性それぞれの平均購入金額</strong>を表します。</p>
        <p>それぞれのバーには、<strong>バーの高さを中心にエラーバーと呼ばれるひげのようなもの</strong>がついています。これが<strong>誤差範囲</strong>を表します。</p>
        <p><strong>データから算出された標本平均がバーの高さにあるならば、母集団の真の平均購入金額は、おおよそこの誤差範囲のどこかに分布しているだろう、という範囲</strong>を示しています。この区間を<strong>信頼区間</strong>と呼びます。</p>
        <p><strong>信頼区間を求めること</strong>は、推測統計のうち<strong>統計的推定</strong>に相当します。</p>
        <p>信頼区間は確率をもって設定するため、どの程度の精度で推測したいかによってひげの長さは変わってきますが、<strong>一般的には95%信頼区間</strong>を求めることが多いです。</p>
        <p>この95%という数字の解釈には、注意が必要です。</p>
        <p>95％信頼区間は、<strong>真の母集団の平均が信頼区間内にある確率が95％だと言っているわけではありません。</strong></p>
        <p>正しくは、<strong>信頼区間が100個あるときに95個の信頼区間には真の母集団の平均が含まれる</strong>ことを表します。</p>
        <p>ここまでの話をきちんと理解するためには、確率を勉強する必要がありますが、大事なことは、<strong>エラーバーがあることによって、標本から得られたグループ間の平均の差が、意味のある差なのか、それとも単なる偶然によって得られた差なのかをざっくりと知ることができる</strong>ということです。</p>
        <p>2つのグラフの<strong>エラーバーの範囲が重なっていなければ、グループ間の平均には統計的に差がある</strong>と言えますし、<strong>エラーバーの範囲がほとんど重なっていれば、グループ間の平均に統計的な差があるとは言えない</strong>ことになります。</p>
        <p>エラーバー付棒グラフを作れるようになると、さまざまな分析が可能になります。例えば</p>
        <ul>
        <li>昼と夜で売上金額が変化するのかを知ることができる</li>
        <li>曜日によって利用者の平均年齢が変化するのかを知ることができる</li>
        <li>打ち出した広告に効果があったのかを検証することができる</li>
        </ul>
        <p>ランダムサンプリングされたデータと、標準誤差の知識があれば、工夫次第で大抵の疑問に答えることができます。少し難しい話ではありますが、ぜひ使い方をマスターしましょう。</p>
        <h4
        id="excelで標準誤差を考慮した棒グラフを作る">Excelで標準誤差を考慮した棒グラフを作る</h4>
        <p>Excelでエラーバー付棒グラフを作るには、まず、グループ別にデータを整理する必要があります。</p>
        <p>いくつか方法はありますが、グループごとにデータを分割すると分かりやすいでしょう。</p>
        <p>ここでは、男女で平均購入金額の差があるかどうかを分析していきます。</p>
        <p><strong>データ分割方法</strong></p>
        <p><img src="fig_dataintro_sebar_filter.png" /></p>
        <ol type="1">
        <li><code>gender</code>変数でフィルタをかけ、男性のデータのみを表示
        <ul>
        <li>グループを規定する変数でフィルタをかけるので、例えば、商品別に分けるなら<code>item</code>変数でフィルタをかける</li>
        </ul></li>
        <li>フィルタリングされたデータをすべてコピーし、適当なところにペーストする</li>
        <li>女性についても1と2を行う</li>
        </ol>
        <p>男女別にデータを分割できたら、以下のような表を作ります。</p>
        <p><img src="fig_dataintro_sebar_table.png" /></p>
        <p><strong>必要項目</strong></p>
        <ul>
        <li>男女別の平均
        <ul>
        <li><code>AVERAGE</code>関数を使う</li>
        </ul></li>
        <li>男女別の不偏分散
        <ul>
        <li><code>STDEV.S</code>関数を使う</li>
        </ul></li>
        <li>男女別のサンプルサイズ
        <ul>
        <li><code>COUNT</code>関数を使う
        <ul>
        <li><code>COUNT</code>関数はデータ範囲を指定して、<code>= COUNT(データ範囲)</code>のように使う</li>
        </ul></li>
        </ul></li>
        <li>男女別の標準誤差
        <ul>
        <li>男女別に計算した平均、不偏分散、サンプルサイズを使って計算する</li>
        <li>セルに<code>= 不偏分散のセル番地/SQRT(サンプルサイズのセル番地)</code>と入力</li>
        <li><code>SQRT()</code>関数は、（）内に指定した数値（計算式でもOK）の平方根を返す関数</li>
        </ul></li>
        <li>男女別の信頼区間
        <ul>
        <li>男女別の標準誤差を使って計算</li>
        <li>95％信頼区間：<code>= 1.96*標準誤差のセル番地</code>と入力</li>
        <li>かける数字の大きさによってさまざまな信頼区間を計算可能
        <ul>
        <li>90％信頼区間：<code>= 1.64*標準誤差のセル番地</code></li>
        <li>99％信頼区間：<code>= 2.58*標準誤差のセル番地</code></li>
        </ul></li>
        </ul></li>
        </ul>
        <p><img src="fig_dataintro_sebar_count.png"
        alt="サンプルサイズ" /> <img src="fig_dataintro_sebar_se.png"
        alt="標準誤差" /> <img src="fig_dataintro_sebar_ci.png"
        alt="信頼区間" /></p>
        <p>表ができたら、グループ名と各平均値のセルを選択し、棒グラフを作ります。できたグラフに、以下の手順でエラーバーを追加しましょう。</p>
        <p><strong>エラーバー追加手順</strong></p>
        <ol type="1">
        <li>グラフを選択し、<strong>グラフのデザイン</strong>→<strong>グラフ要素を追加</strong>→<strong>誤差範囲</strong>→<strong>その他の誤差範囲オプション</strong>の順に選択</li>
        <li>誤差範囲の追加ウィンドウでエラーバーを追加したいグループ名を選択しOKをクリック</li>
        <li><strong>誤差範囲の書式設定</strong>メニューの<strong>誤差範囲</strong>から<strong>ユーザー設定</strong>を選択</li>
        <li>ユーザー設定の誤差範囲ウィンドウで、<strong>正の誤差の値</strong>と<strong>負の誤差の値</strong>両方に計算した<strong>信頼区間のセル番地</strong>を指定</li>
        </ol>
        <p><img src="fig_dataintro_sebar_gen.png" alt="グラフの選択" />
        <img src="fig_dataintro_sebar_gen1.png" alt="標準誤差を追加" />
        <img src="fig_dataintro_sebar_gen2.png"
        alt="標準誤差の設定" /></p>
        <p>これで、エラーバー付棒グラフを作成できました。</p>
        <p><img src="fig_dataintro_sebar.png" /></p>
        <p>男性のほうが女性より平均購入金額が高く、しかも、男女のエラーバーが重なる範囲がないため、真の平均購入金額も男女で異なる可能性が高いといえます。</p>
        </details>
        <h1 id="仮説検定-1">仮説検定</h1>
        <details>
        <summary>
        仮説検定セクションを見る（クリックで開閉）
        </summary>
        <p>エラーバー付棒グラフを作成することで、グループ間で平均値に差があるかどうかをざっくりと知ることができました。</p>
        <p>しかし、これはあくまでもざっくりとした分析です。</p>
        <ul>
        <li>男女間で平均購入金額に統計的に意味がある差が存在するのではないか</li>
        <li>広告によって売り上げは向上したのではないか</li>
        <li>時間帯によって客層は異なるのではないか</li>
        </ul>
        <p>こういった<strong>仮説</strong>にしっかりと答えるためには、何らかの<strong>客観的な基準で評価をする</strong>ことが必要です。</p>
        <p>データを利用して、このような<strong>仮説が正しいかどうかを客観的に判断することを仮説検定</strong>と呼びます。</p>
        <p>例えば、男女間で平均購入金額に差があるのではないか、という仮説を検討します。</p>
        <p>データから得られた平均購入金額は、男性が約438円、女性が約408円でした。</p>
        <p>男性の方が30円多く購入しているから、<strong>男女間では平均購入金額に差があると言える</strong>でしょうか？それとも、たまたま選ばれたデータによって<strong>偶然生じた差にすぎない</strong>のでしょうか？</p>
        <p>仮に言えたとして、<strong>何円以上の差があれば男女間に差があると言えるでしょうか？</strong></p>
        <p>この問いに答えるために、まずは<strong>仮説を立てます</strong>。</p>
        <p>統計的手法を用いて仮説検定を行う際には、<strong>仮説の立て方に少し独特な作法があります</strong>。</p>
        <ul>
        <li><strong>×</strong>　男女間で平均購入金額に差が<strong>ある</strong></li>
        <li><strong>〇</strong>　男女間で平均購入金額に差は<strong>ない</strong></li>
        </ul>
        <p>このように、<strong>差はないという仮説を立て</strong>、この仮説を統計的に否定する（<strong>棄却する</strong>）ことで、<strong>男女間で平均購入金額に差があるという仮説を支持</strong>します。</p>
        <h4 id="帰無仮説と対立仮説">帰無仮説と対立仮説</h4>
        <ul>
        <li><strong>帰無仮説</strong>：「差はない」という<strong>否定したい仮説</strong>のこと
        <ul>
        <li>否定することによって無に帰す仮説という意味</li>
        <li>上の例では、「男女間で平均購入金額に差は<strong>ない</strong>」という仮説のこと</li>
        </ul></li>
        <li><strong>対立仮説</strong>：「差がある」という<strong>支持したい仮説</strong>のこと
        <ul>
        <li>帰無仮説に対立するという意味</li>
        <li>上の例では、「男女間で平均購入金額に差が<strong>ある</strong>」という仮説のこと</li>
        <li>対立仮説を「男性の方が女性より平均購入金額が高い」とすることもできる
        <ul>
        <li>対立仮説が「差がある」のとき：男性の方が平均購入金額が高いときと低いときの両方を支持する（<strong>両側検定</strong>という）</li>
        <li>対立仮説が「男性の方が女性より平均購入金額が高い」のとき：男性の方が平均購入金額が高いという片側の差のみを支持する（<strong>片側検定</strong>という）</li>
        </ul></li>
        </ul></li>
        </ul>
        <p>少し回りくどく見えるかもしれませんが、「<strong>差がある</strong>」<strong>ことを仮説にするのは意外と難しい</strong>のです。</p>
        <p>大きな理由は、<strong>どの程度の大きさであれば</strong>「<strong>差がある</strong>」<strong>と言えるのか、客観的な指標で判断しづらい</strong>ことです。10円の差を「差がある」と言う人もいれば、100円の差があっても「差はない」と言う人もいるかもしれません。</p>
        <p>また、同じ差であっても、データの単位によってその大きさは違って見えます。</p>
        <p>例えば、同じ「30円多い」と言っても、顧客の平均購入金額が100円のときと、10,000円のときとでは、意味が100倍違います。
        100円に対する30円は大きな差に見えますが、10,000円に対する30円は、それこそ単なる誤差に見えます。</p>
        <p>また、「差がある」ときには「差がある」と言うことができますが、「<strong>差が観察できない</strong>」<strong>ときには、</strong>「<strong>実際に差がない</strong>」<strong>のか、</strong>「<strong>実際には差があるけど観察できていないだけ</strong>」<strong>なのかを判断することが難しい</strong>という理由もあります。</p>
        <p>そこで、 1. <strong>差がないことが正しいと仮定</strong>し、
        2.
        <strong>得られたデータが「差がない」前提の下ではとても珍しい確率でしか得られないもの</strong>だとしたら、
        3. <strong>差がないという前提を否定</strong>する、</p>
        <p>という手順を踏むことで、「差がある」という仮説を支持していくのです。</p>
        <h3
        id="excelで仮説検定t検定をする">Excelで仮説検定（t検定）をする</h3>
        <p><strong>男女間での平均購入金額に差があるかどうかという仮説を例</strong>に、仮説検定の中でも、特に
        <strong><span class="math inline">\(t\)</span>
        検定の手順</strong>を見ていきましょう。<span
        class="math inline">\(t\)</span>
        検定は、<strong>平均値の差があるかどうかを検定するときに使われる手法</strong>です。手順は以下の通りです。</p>
        <ol type="1">
        <li><strong>有意水準を決める</strong></li>
        <li><strong>仮説を立てる</strong></li>
        <li><strong><span class="math inline">\(t\)</span>
        検定を実行する</strong></li>
        <li><strong>結果を解釈する</strong></li>
        </ol>
        <p>1つひとつを詳しく見ていきましょう。</p>
        <h4 id="有意水準を決める">1. 有意水準を決める</h4>
        <p>まずは、<strong>どういう数字が出てきたら帰無仮説を棄却するか</strong>、最初に基準となる数字を決めておきます。</p>
        <p>具体的には、<strong>男女間での平均購入金額に差がないという仮説が正しいときに、手元のデータの平均の差が
        <span class="math inline">\(X\)</span> 円以上となる確率が <span
        class="math inline">\(\alpha\)</span>
        以下であれば、差がないという前提が間違っていたと判断する</strong>ときの
        <strong><span class="math inline">\(\alpha\)</span></strong>
        という数字です。</p>
        <p>慣例的に <strong><span class="math inline">\(\alpha\)</span>
        は <span class="math inline">\(5\%\)</span></strong>
        とすることが多いです。</p>
        <p>以降の手順で<strong>男女間での平均購入金額に差がないという仮説が正しいときに、手元のデータの平均の差が
        <span class="math inline">\(X\)</span>
        円以上となる確率</strong>を求めていくので、判断に主観が入らないよう、先に決めておく必要があります。</p>
        <h4 id="仮説を立てる">2. 仮説を立てる</h4>
        <p>次に、仮説を立てます。</p>
        <p>先に述べたように、男女間で平均購入金額に差があるかどうかを検定するときは、<strong>男女間での平均購入金額に差がない</strong>という帰無仮説を立てます。</p>
        <p>男性の平均購入金額を <span
        class="math inline">\(\overline{sales}_{男}\)</span>、女性の平均購入金額を
        <span class="math inline">\(\overline{sales}_{女}\)</span>
        とすると、帰無仮説 <span class="math inline">\(\mu_{0}\)</span>
        は</p>
        <p><span class="math display">\[
        \mu_{0}: \bar{X} \equiv \overline{sales}_{男} -
        \overline{sales}_{女} = 0
        \]</span></p>
        <p>という式で表すことができます。</p>
        <h4 id="t-検定を実行する">3. <span
        class="math inline">\(t\)</span> 検定を実行する</h4>
        <p>ここからは、Excelのデータ分析ツールを使って検定を行っていきます。</p>
        <p>データ分析ツールは、Excelの「データ」タブ内にある「<strong>データ分析</strong>」をクリックすると使えます。</p>
        <p>「データ分析」が見つからないときは、先に「<strong>分析ツールアドイン</strong>」を追加する必要があります。</p>
        <h5 id="分析ツールアドインの追加">分析ツールアドインの追加</h5>
        <ol type="1">
        <li>「ファイル」タブ→「オプション」を選択</li>
        <li>「アドイン」→「設定」を選択</li>
        <li>「分析ツール」にチェックを入れ、OKをクリック</li>
        <li>Excelを再起動する</li>
        </ol>
        <p>次に、<strong>データ分析ツールに合わせてデータを加工</strong>します。</p>
        <p><a
        href="#excelで標準誤差を考慮した棒グラフを作る">Excelで標準誤差を考慮した棒グラフを作る</a>と同じように、男性のデータと女性のデータに分割しましょう。</p>
        <p>分割ができたら、「分析ツール」を起動します。分析ツールから
        <strong>t 検定:
        等分散を仮定した2標本による検定</strong>を選択し、必要なオプションを入力します。</p>
        <p><img src="fig_dataintro_ttest_gen.png" /></p>
        <h5 id="t-検定のオプション">t 検定のオプション</h5>
        <p><img src="fig_dataintro_ttest_input.png" /></p>
        <table>
        <colgroup>
        <col style="width: 33%" />
        <col style="width: 66%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>項目</th>
        <th>内容</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td>変数1の入力範囲</td>
        <td>1つ目のデータの範囲<br> ここでは男性のデータの範囲</td>
        </tr>
        <tr class="even">
        <td>変数2の入力範囲</td>
        <td>2つ目のデータの範囲<br> ここでは女性のデータの範囲</td>
        </tr>
        <tr class="odd">
        <td>仮説平均との差異</td>
        <td>帰無仮説で設定した差を入力（デフォルトは <span
        class="math inline">\(0\)</span>）<br> ここでは空欄または0</td>
        </tr>
        <tr class="even">
        <td>ラベル</td>
        <td>データ範囲にラベル（列名）が含まれるときはチェックを入れる</td>
        </tr>
        <tr class="odd">
        <td><span class="math inline">\(\alpha\)</span></td>
        <td>有意水準（デフォルトは <span
        class="math inline">\(0.05\)</span>）</td>
        </tr>
        <tr class="even">
        <td>出力オプション</td>
        <td>結果を出力したいセルを入力<br>　・<strong>出力先</strong>：同じシートに出力したいときにセルを指定<br>　・<strong>新規ワークシート</strong>：シート名を記入（空欄でもOK）<br>　・<strong>新規ブック</strong>：ファイル名を記入（空欄でもOK）</td>
        </tr>
        </tbody>
        </table>
        <p>以上を入力してOKをクリックすると、指定した出力先に結果が表示されます。</p>
        <h4 id="結果を解釈する">4. 結果を解釈する</h4>
        <p>オプションが正しく入力されていれば、以下のような結果が表示されるはずです。</p>
        <p><img src="fig_dataintro_ttest_result.png" /></p>
        <h5 id="結果の表">結果の表</h5>
        <table>
        <colgroup>
        <col style="width: 45%" />
        <col style="width: 54%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>項目</th>
        <th>説明</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><strong>ラベル</strong></td>
        <td>データに設定した列名</td>
        </tr>
        <tr class="even">
        <td><strong>平均</strong></td>
        <td>各データ（ここでは男女それぞれ）の平均値　</td>
        </tr>
        <tr class="odd">
        <td><strong>分散</strong></td>
        <td>各データ（ここでは男女それぞれ）の不偏分散</td>
        </tr>
        <tr class="even">
        <td><strong>観測数</strong></td>
        <td>各データ（ここでは男女それぞれ）のサンプルサイズ</td>
        </tr>
        <tr class="odd">
        <td><strong>プールされた分散</strong></td>
        <td><strong>割愛</strong></td>
        </tr>
        <tr class="even">
        <td><strong>仮説平均との差異</strong></td>
        <td>仮説平均との差異に設定した値（ここでは0）</td>
        </tr>
        <tr class="odd">
        <td><strong>自由度</strong></td>
        <td><strong>割愛</strong></td>
        </tr>
        <tr class="even">
        <td><strong>t</strong></td>
        <td>t値と呼ばれ、各データの差（ここでは男女間の差）を評価する値<br>この値が大きいほど各データの差（ここでは男女間の差）が大きいことを示す</td>
        </tr>
        <tr class="odd">
        <td><strong>P(T &gt;= t) 片側</strong></td>
        <td>片側検定（対立仮説が「男性の方が女性より平均購入金額が高い」あるいは「男性の方が女性より平均購入金額が低い」）の場合の
        <span class="math inline">\(p\)</span> 値（<span
        class="math inline">\(p\)</span> 値については後述）</td>
        </tr>
        <tr class="even">
        <td><strong>t 境界値 片側</strong></td>
        <td>片側検定の場合の棄却限界値<br>t値がこの値を超えると帰無仮説を棄却できる</td>
        </tr>
        <tr class="odd">
        <td><strong>P(T &gt;= t) 両側</strong></td>
        <td>両側検定（対立仮説が「男女間で平均購入金額に差がある」）の場合の
        <span class="math inline">\(p\)</span> 値</td>
        </tr>
        <tr class="even">
        <td><strong>t 境界値 両側</strong></td>
        <td>両側検定の場合の棄却限界値</td>
        </tr>
        </tbody>
        </table>
        <p>いろいろと数値が出力されてややこしいかもしれませんが、<strong>注目すべきは
        P(T&gt; =t)（<span class="math inline">\(p\)</span>
        値）</strong> です。</p>
        <p>これは、<strong>「男女間の平均購入金額に差がない」という帰無仮説が正しいときに、手元のデータで観察される差が生じるのはどのくらい珍しいことなのかを表す確率</strong>です。</p>
        <p>私たちは最初に、<strong>男女間での平均購入金額に差がないという仮説が正しいときに、手元のデータの平均の差が
        <span class="math inline">\(X\)</span> 円以上となる確率が <span
        class="math inline">\(\alpha\)</span>
        以下であれば、差がないという前提が間違っていたと判断する</strong>と決めました。</p>
        <p>よって、<span class="math inline">\(t\)</span> 検定で得られた
        <span class="math inline">\(p\)</span> 値と最初に決めた <span
        class="math inline">\(\alpha\)</span> を比較し、<strong><span
        class="math inline">\(p&lt; \alpha\)</span>
        であれば帰無仮説を棄却</strong>し、<strong><span
        class="math inline">\(p&gt; \alpha\)</span>
        であれば帰無仮説を支持する</strong>という判断を行うことになります。</p>
        <p>ここで得られた結果では、<span
        class="math inline">\(p\)</span> 値は <span
        class="math inline">\(9.83813 \times 10^{-10}
        \left(=\frac{9.83813}{10^{10}}\right)\)</span>
        という、非常に小さい値になっています。</p>
        <p>これはつまり、「<strong>男女の購入金額の差が0円である</strong>」<strong>という帰無仮説が正しい場合に、手元のデータで観測されたような30円の差が生じる確率は、わずか</strong>
        <span class="math inline">\(0.0000000983813\%\)</span>
        <strong>しかない</strong>、ということを意味します。</p>
        <p>私たちは事前に、<strong>観測された差が偶然によって生じる確率（<span
        class="math inline">\(p\)</span> 値）が <span
        class="math inline">\(5\%\)</span>
        以下であれば、帰無仮説を棄却する（<span
        class="math inline">\(=\)</span>差がないという前提を否定する）</strong>と決めていました。</p>
        <p>したがって、この場合は「<strong>男女の購入金額の差が0円である</strong>」<strong>という前提は成り立たない</strong>と判断し、<strong>男女の購入金額に統計的に有意な差があると結論</strong>づけることができます。</p>
        <p>以上のように、仮説検定では<strong>偶然では説明できない差があるのかどうか</strong>を、データに基づいて判断することができます。特に
        <strong><span class="math inline">\(p\)</span>
        値は、その差が偶然に生じる確率を数値で示してくれる</strong>ため、データの意味を客観的に捉えるための強力なツールとなります。</p>
        <p>特に、ここで学んだ<span class="math inline">\(t\)</span>
        <strong>検定（平均の差の検定）では、観測された差や効果が偶然によるものかどうかを判断することができます</strong>。しかし、実際のデータでは複数の要因が同時に影響している場合が多く、単純な比較だけでは不十分です。次に学ぶ回帰分析では、変数同士の関係（相関）を数式で表現し、データの傾向を把握したり、将来の値を予測したりすることが可能になります。</p>
        </details>
        <h1 id="回帰分析">回帰分析</h1>
        <details>
        <summary>
        回帰分析セクションを見る（クリックで開閉）
        </summary>
        <p>このセクションでは、<strong>回帰分析</strong>について学んでいきます。</p>
        <p>一般に回帰（regression）とは「<strong>興味のある変数（<span
        class="math inline">\(Y\)</span>）の値を、他の変数（<span
        class="math inline">\(X\)</span>）を用いて予測すること</strong>」を指します。</p>
        <p>例えば、学食に来た人の性別（<span
        class="math inline">\(X\)</span>）を手掛かりに、その人が何円の商品を購入するか（<span
        class="math inline">\(Y\)</span>）を予測することが回帰分析にあたります。</p>
        <p>このときに、手掛かりにする変数（<span
        class="math inline">\(X\)</span>）を<strong>説明変数</strong>（または<strong>独立変数</strong>）と言い、予測する変数（<span
        class="math inline">\(Y\)</span>）を<strong>被説明変数</strong>（または<strong>従属変数</strong>）と呼びます。</p>
        <p>回帰分析は大きく<strong>ノンパラメトリック回帰</strong>と<strong>パラメトリック回帰</strong>に分けられ、パラメトリック回帰の中で最もよく使われるのが<strong>線形回帰</strong>です。</p>
        <p>ちなみに、<strong>パラメトリック</strong>という言葉は、「<strong>パラメータに関連する</strong>」や「<strong>パラメータで表される</strong>」という意味を持ち、統計学では特に<strong>分析の際にパラメータの値を仮定すること</strong>を指します。つまり、<span
        class="math inline">\(Y\)</span>を<span
        class="math inline">\(X\)</span>で予測するときに、<span
        class="math inline">\(Y\)</span><strong>が</strong><span
        class="math inline">\(X\)</span><strong>の関数として表されることを仮定するのがパラメトリック回帰</strong>、<strong>関数形を仮定しないのがノンパラメトリック回帰</strong>です。</p>
        <p>以降では、ノンパラメトリック回帰と線形回帰について説明し、データを用いた予測方法を学んでいきます。</p>
        <h2 id="ノンパラメトリック回帰">ノンパラメトリック回帰</h2>
        <p>ここでは、<strong>男女別に売上金額を予測する</strong>ことを考えます。また、十分多くの人たちについて、各個人の購入金額<span
        class="math inline">\(Y\)</span>と性別<span
        class="math inline">\(X\)</span>のペア <span
        class="math inline">\((Y, X)\)</span>
        がランダムサンプリングした標本として観察できることを前提とします。</p>
        <p>ノンパラメトリック回帰の場合は、まずサンプルを男女に分割し、男性の売上金額、女性の売上金額をそれぞれ予測します。</p>
        <p>予測を行う際には、<strong>正確に予測すること</strong>を目指します。</p>
        <p><strong>正確に予測できている状態</strong>とは、<strong>予測誤差</strong>（prediction
        error）<strong>が最小である状態</strong>です。</p>
        <p>予測誤差は、<span
        class="math inline">\(X\)</span><strong>によって予測した</strong><span
        class="math inline">\(Y\)</span><strong>の値、</strong><span
        class="math inline">\(\hat{Y}\)</span><strong>と、実際の</strong><span
        class="math inline">\(Y\)</span><strong>の値の差</strong>として表されます。</p>
        <p>私たちの手元に、<span class="math inline">\(\{Y_{1}, Y_{2},
        \dots, Y_{i}, \dots, Y_{N}\}\)</span>という<span
        class="math inline">\(N\)</span>個のデータがあるとき、予測誤差を<span
        class="math inline">\(\varepsilon_{i}\)</span>とすると、予測誤差のデータは以下のようになります。</p>
        <p><span class="math display">\[
        \varepsilon_{1} = Y_{1}- \hat{Y}, \varepsilon_{2} = Y_{2}-
        \hat{Y}, \dots, \varepsilon_{i} = Y_{i}- \hat{Y}, \dots,
        \varepsilon_{N} = Y_{N}- \hat{Y}
        \]</span></p>
        <p>予測誤差は正負どちらの値も取りうるので、<strong>平均二乗誤差</strong>（<strong>MSE:
        Mean Squared
        Error</strong>）を使って予測誤差全体の大きさを評価します。</p>
        <p><span class="math display">\[
        MSE = \frac{1}{N}(\varepsilon_{1}^{2} + \varepsilon_{2}^{2} +
        \cdots + \varepsilon_{i}^{2} + \cdots + \varepsilon_{N}^{2}) =
        \frac{1}{N}\sum_{i = 1}^{N}(Y_{i}- \hat{Y})^{2}
        \]</span></p>
        <p>このMSEを最小にするような予測値<span
        class="math inline">\(\hat{Y}\)</span>を考えれば、精度の高い予測ができることになります。</p>
        <p>結果だけお伝えすると、<span class="math inline">\(\hat{Y} =
        \bar{Y}\)</span>（<strong><span
        class="math inline">\(Y\)</span>の平均値</strong>）<strong>のときに、MSEが最小</strong>になります。</br>
        （興味がある方は、以下のMSEの計算式を参照してください。）</p>
        <details>
        <summary>
        MSEの計算式を見る（クリックで開閉）
        </summary>
        <p><span class="math display">\[
        \begin{align}
        MSE &amp;= \frac{1}{N}\sum_{i = 1}^{N}(Y_{i}- \hat{Y})^{2} \\
            &amp;=  \frac{1}{N}\left(\sum_{i = 1}^{N}Y_{i}^{2}- 2\sum_{i
        = 1}^{N}Y_{i}\hat{Y} + \sum_{i = 1}^{N}\hat{Y}^{2}\right) \\
            &amp;= \frac{1}{N}\sum_{i = 1}^{N}Y_{i}^{2}-
        2\hat{Y}\times\frac{1}{N}\sum_{i = 1}^{N}Y_{i} +
        \frac{1}{N}\times N\hat{Y}^{2} \\
            &amp;= \frac{1}{N}\sum_{i = 1}^{N}Y_{i}^{2}-
        2\hat{Y}\times\frac{1}{N}\sum_{i = 1}^{N}Y_{i} + \hat{Y}^{2} \\
            &amp;= \left(\frac{1}{N}\sum_{i = 1}^{N}Y_{i}\right)^{2}-
        2\hat{Y}\times\frac{1}{N}\sum_{i = 1}^{N}Y_{i} + \hat{Y}^{2}
        +\frac{1}{N}\sum_{i = 1}^{N}Y_{i}^{2} - \left(\frac{1}{N}\sum_{i
        = 1}^{N}Y_{i}\right)^{2}\\
            &amp;= \left(\frac{1}{N}\sum_{i = 1}^{N}Y_{i} -
        \hat{Y}\right)^{2} + \frac{1}{N}\sum_{i = 1}^{N}Y_{i}^{2} -
        \left(\frac{1}{N}\sum_{i = 1}^{N}Y_{i}\right)^{2}\\
        \end{align}
        \]</span></p>
        <p>よって、<span class="math inline">\(\hat{Y} =
        \frac{1}{N}\sum_{i = 1}^{N}Y_{i} \equiv
        \bar{Y}\)</span>のときMSEは最小値をとる。</p>
        </details>
        <p>つまり、<strong>男性の購入金額の予測値は男性の購入金額の標本平均</strong>、<strong>女性の購入金額の予測値は女性の購入金額の標本平均</strong>となります。</p>
        <p>これは、説明変数<span
        class="math inline">\(X\)</span>のカテゴリ数が多くなっても同じです。</p>
        <p>例えば、年齢を説明変数<span
        class="math inline">\(X\)</span>として被説明変数<span
        class="math inline">\(Y\)</span>である購入金額を予測したいときは、年齢ごとにサンプルを分割し、サンプルごとに購入金額の標本平均を計算します。</p>
        <p>したがって、ノンパラメトリック回帰は、以下の手順で行います。</p>
        <ol type="1">
        <li>データから、説明変数<span
        class="math inline">\(X\)</span>と被説明変数<span
        class="math inline">\(Y\)</span>（ここでは、各個人の性別と売上金額）をペアにしたサンプルを抽出する。</li>
        <li>説明変数<span
        class="math inline">\(X\)</span>の値に基づいて、サンプルを複数のグループに分割する（ここでは、男性グループと女性グループに分割する）。</li>
        <li>各グループ内で平均値<span
        class="math inline">\(\bar{Y}\)</span>を計算し、その結果を予測値とする。</li>
        </ol>
        <p>このような回帰分析の方法を、予測値に関数形を課さないという意味で、ノンパラメトリック回帰と言います。</p>
        <h3
        id="excelを使ったノンパラメトリック回帰">Excelを使ったノンパラメトリック回帰</h3>
        <p>それでは、<strong>男女それぞれの売上金額をノンパラメトリック回帰に基づいて予測</strong>してみましょう。</p>
        <p><code>gender</code>変数でフィルタをかけ、男女別に<code>sales</code>変数を分割し、<code>AVERAGE</code>関数を使って、男女それぞれの平均売上金額を計算すればそれでOKです。</br>
        （関数の使い方は<a
        href="#excelで標準誤差を考慮した棒グラフを作る">Excelで標準誤差を考慮した棒グラフを作る</a>を参照してください。）</p>
        <p>あるいは、<code>AVERAGEIFS</code>関数を使って、生のデータから男女それぞれの売上金額を抽出し、平均を計算しても良いです。<code>AVERAGEIFS</code>関数は、<code>COUNTIFS</code>関数とほとんど同じように使えます。</p>
        <h6 id="averageifs関数"><code>AVERAGEIFS</code>関数</h6>
        <p>複数の条件を満たすすべてのセルの平均を返す関数です。</p>
        <p><code>AVERAGEIFS(平均範囲, 条件範囲 1, 条件 1, [条件範囲 2, 条件 2], ...)</code></p>
        <p>（例）男性の平均売上金額：<code>= AVERAGEIFS($B:$B, $A:$A, "男")</code></p>
        <p><img src="fig_dataintro_nonpara.png" /></p>
        <p>データから得られた平均購入金額は、男性が約438円、女性が約408円でした。これらの値が、それぞれの性別における売上金額の予測値として用いられます。</p>
        <h3
        id="ノンパラメトリック回帰の注意点">ノンパラメトリック回帰の注意点</h3>
        <p><strong>ノンパラメトリック回帰が可能な場合には、サンプルを分割して平均を計算するだけで、十分有用</strong>な予測値を得られます。</p>
        <p>しかし、ノンパラメトリック回帰には弱点もあります。</p>
        <p>第一に、ノンパラメトリック回帰で十分な予測精度を担保するためには、<strong>それなりのサンプルサイズが必要</strong>です。</p>
        <p>一般には、サンプルサイズが30以上であれば比較的安定した結果を得られると言われていますので、男女それぞれ30人ずつのデータを集められればとりあえず基準はクリアしたことになります。</p>
        <p>この基準は、説明変数<span
        class="math inline">\(X\)</span>に多くの項目が含まれる場合、さらにシビアになります。</p>
        <p>例えば、説明変数<span
        class="math inline">\(X\)</span>に性別（男/女）と職位（学生/職員）の両方を含むとすると、<span
        class="math inline">\(2 \times 2 =
        4\)</span>グループにサンプルを分割するので、それぞれ30以上のサンプルサイズが必要、全体として120以上のサンプルサイズが必要になってしまいます。</p>
        <p>このように、<strong>サンプルを細かく分割すると、1つ1つのグループのサンプルサイズが小さくなり、予測精度が下がる</strong>要因になってしまいます。</p>
        <p>第二に、<strong>事前に説明変数</strong><span
        class="math inline">\(X\)</span><strong>と被説明変数</strong><span
        class="math inline">\(Y\)</span><strong>の関係が想定されるときに、全体の傾向が見づらい</strong>ことがあります。</p>
        <p>例えば、年齢と売上金額の関係を考えてみます。若い人の方がたくさん食べられるので売上金額は高い傾向にあるかもしれないし、年齢を重ねた人の方が金銭的に余裕があって売上金額が高い傾向にあるかもしれません。</p>
        <p><img src="fig_dataintro_agesales.png" /></p>
        <p>上図は年齢ごとに売上金額をプロットしたものと、それをノンパラメトリック回帰した結果を表しています。</p>
        <p>「<strong>1年歳をとることで売上金額が何円上がるか</strong>（<strong>下がるか</strong>）」という<strong>全体的な傾向をノンパラメトリック回帰の結果から解釈することは難しい</strong>でしょう。</p>
        <p>横軸の取りうる値がもっと細かくなれば、回帰曲線自体がよりギザギザとなって見づらくなることもありますし、説明変数が手元のデータにないの値（ここでは、例えば15歳の人や40歳の人など）をとるときの予測値を計算することもできません。</p>
        <h2 id="線形回帰">線形回帰</h2>
        <p><a
        href="#ノンパラメトリック回帰の注意点">ノンパラメトリック回帰の注意点</a>に挙げたような問題点に対処するために、<strong>説明変数<span
        class="math inline">\(X\)</span>と被説明変数<span
        class="math inline">\(Y\)</span>の関係になんらかの関数形を仮定する方法が、パラメトリック回帰</strong>です。</p>
        <p>例えば、関数形を以下のように仮定することができます。</p>
        <ul>
        <li><span class="math display">\[ Y = \beta_{0} + \beta_{1} X
        \]</span></li>
        <li><span class="math display">\[ Y = \beta_{0} + \beta_{1} X +
        \beta_{2} X^{2} \]</span></li>
        <li><span class="math display">\[ Y = \frac{\beta}{X}
        \]</span></li>
        <li><span class="math display">\[ Y = \beta_{0} e^{\beta_{1} X}
        \]</span></li>
        </ul>
        <p>特に、<strong>被説明変数<span
        class="math inline">\(Y\)</span>は説明変数<span
        class="math inline">\(X\)</span>の1次式であると仮定する方法を線形回帰</strong>（<strong>linear
        regression</strong>）<strong>といいます</strong>。</p>
        <p>例えば、売上金額（<code>sales</code>）は気温（<code>temp</code>）の1次式であると仮定すると、売上金額は以下の式で表すことができます。</p>
        <p><span class="math display">\[
        sales = \beta_{0} + \beta_{1} \times temp + \varepsilon
        \]</span></p>
        <p>例のように、<strong>説明変数が一つのときには特に単回帰式</strong>といい、<strong>説明変数が二つ以上の時には重回帰式</strong>といいます。</p>
        <p>ここで、回帰式についていくつかの専門用語を整理しておきます。</p>
        <p><span class="math inline">\(Y = \beta_{0} + \beta_{1} X +
        \varepsilon\)</span> のような<strong>説明変数<span
        class="math inline">\(X\)</span>と被説明変数<span
        class="math inline">\(Y\)</span>の関係式を回帰式</strong>（<strong>回帰式</strong>）と呼び、<strong>直線の切片<span
        class="math inline">\(\beta_{0}\)</span>、直線の傾き<span
        class="math inline">\(\beta_{1}\)</span>を回帰係数</strong>と呼びます。</p>
        <p><strong>線形回帰は、手元のデータ<span
        class="math inline">\((temp,
        sales)\)</span>の組み合わせから、データの動きを最もよく表す直線の回帰係数<span
        class="math inline">\((\beta_{0},
        \beta_{1})\)</span>を見つける作業</strong>です。</p>
        <p>データの動きを最もよく表す直線とは、（ノンパラメトリック回帰と同様に）予測誤差の少ない直線のことです。</p>
        <p>ここでも、予測誤差は<span
        class="math inline">\(\varepsilon\)</span>で表されるので、回帰係数<span
        class="math inline">\((\beta_{0},
        \beta_{1})\)</span>のもとで、回帰式 <span
        class="math inline">\(Y = \beta_{0} + \beta_{1} X +
        \varepsilon\)</span> のMSEは以下の式で表されます。</p>
        <p><span class="math display">\[
        MSE = \frac{1}{n} \sum_{i=1}^{n} (Y_{i} - \beta_{0} - \beta_{1}
        X_{i})^{2}
        \]</span></p>
        <p><strong>この誤差を最小にする回帰係数の値</strong><span
        class="math inline">\((\hat{\beta_{0}},
        \hat{\beta_{1}})\)</span><strong>を、最小二乗推定量</strong>、あるいは<strong>OLS(ordinary
        least squares)推定量と呼びます</strong>。</p>
        <p>具体的な導出過程は割愛しますが、OLS推定量は以下の式で求められます。</p>
        <p><span class="math display">\[
        \begin{align}
        \hat{\beta_{1}} &amp;= \frac{\sum_{i=1}^{n}(Y_{i} -
        \bar{Y})(X_{i} - \bar{X})}{\sum_{i=1}^{n}(X_{i} - \bar{X})^{2}}
        \\
        &amp;= \frac{\sum_{i=1}^{n}(Y_{i} - \bar{Y})(X_{i} -
        \bar{X})/(n-1)}{\sum_{i=1}^{n}(X_{i} - \bar{X})^{2}/(n-1)} \\
        &amp;= \mathbf{\frac{XとYの標本共分散}{Xの標本分散}} \\
        \hat{\beta_{0}} &amp;= \bar{Y} - \hat{\beta_{1}}\bar{X}
        \end{align}
        \]</span></p>
        <p>式を見ていただいて予想がつくかもしれませんが、<span
        class="math inline">\(\beta_{1}\)</span>（<strong>傾きの係数</strong>）<strong>の方が大切</strong>です（<span
        class="math inline">\(\beta_{0}\)</span>はおまけのようなものです）。</p>
        <p>直線において、説明変数<span
        class="math inline">\(X\)</span>と被説明変数<span
        class="math inline">\(Y\)</span>が相関するかどうかを決めるのが傾きの係数だからです。</p>
        <p><strong><span
        class="math inline">\(\beta_{1}\)</span>がほとんど<span
        class="math inline">\(0\)</span>のケース</strong>を考えます。
        散布図と回帰曲線は、例えばこんな感じになります。</p>
        <p><img src="fig_dataintro_0slope.png" /></p>
        <p>被説明変数<span
        class="math inline">\(Y\)</span>の値が、説明変数<span
        class="math inline">\(X\)</span>の値にかかわらず分布している、つまり、<strong>説明変数<span
        class="math inline">\(X\)</span>と被説明変数<span
        class="math inline">\(Y\)</span>が連動して動いていない</strong>ことが読み取れると思います。</p>
        <p>このような状態では、説明変数<span
        class="math inline">\(X\)</span>から被説明変数<span
        class="math inline">\(Y\)</span>の値を予測することはできません。</p>
        <p>よって、ある変数を用いてほかの変数の値を予測したいときや、何か意味のある相関を見つけたいときは、<strong>傾きが<span
        class="math inline">\(0\)</span>ではないことを確認する必要がある</strong>のです。</p>
        <h3 id="excelで回帰分析をする">Excelで回帰分析をする</h3>
        <p>Excelで回帰分析をするとき、単回帰分析（説明変数<span
        class="math inline">\(X\)</span>が1つだけ）の場合は2通りの方法があります。</p>
        <h4 id="散布図に近似曲線を追加する">1.
        散布図に近似曲線を追加する</h4>
        <ol type="1">
        <li>散布図を作る（<a
        href="dataintro_descriptive.html#散布図">記述統計（散布図）</a>を参照）</li>
        <li>散布図を選択し、「デザイン」タブ→「グラフ要素を追加」→「近似曲線」→「線形」の順に選択</li>
        </ol>
        <p><img src="fig_dataintro_linregdot.png" /></p>
        <p><strong>単回帰分析であれば、散布図に近似曲線を追加</strong>するだけで、回帰係数を求めることができます。</p>
        <p>しかし、傾<strong>きが<span
        class="math inline">\(0\)</span>ではないかどうかを確認したいときには、グラフだけでは不十分</strong>です。
        また、説明変数<span
        class="math inline">\(X\)</span>が2つ以上の場合は回帰曲線を図示することはできません。
        その場合は、次のセクションで説明される方法で分析します。</p>
        <h4 id="分析ツールを使う">2. 分析ツールを使う</h4>
        <p><strong>傾きが<span
        class="math inline">\(0\)</span>ではないかどうかを確認したいとき、説明変数<span
        class="math inline">\(X\)</span>が2つ以上の場合</strong>は、<a
        href="#仮説検定">仮説検定</a>でも使った分析ツールを使います。</p>
        <p>分析ツールの追加方法は<a
        href="#分析ツールアドインの追加">分析ツールアドインの追加</a>を参照してください。</p>
        <p><span class="math display">\[
        sales = \beta_{0} + \beta_{1} \times temp + \varepsilon
        \]</span></p>
        <p>この回帰式の係数を推定してみます。</p>
        <ol type="1">
        <li>「データ」タブ→「データ分析」の順に選択して分析ツールを開く</li>
        <li>「回帰分析」を選択</li>
        <li>必要な項目を記入</li>
        </ol>
        <table>
        <colgroup>
        <col style="width: 31%" />
        <col style="width: 68%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>項目</th>
        <th>内容</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td>入力<span class="math inline">\(Y\)</span>範囲</td>
        <td>被説明変数のデータ範囲を入力</td>
        </tr>
        <tr class="even">
        <td>入力<span class="math inline">\(X\)</span>範囲</td>
        <td>説明変数のデータ範囲を入力</td>
        </tr>
        <tr class="odd">
        <td>ラベルの指定</td>
        <td>1行目に変数名がある場合、「ラベル」にチェックを入れる</td>
        </tr>
        <tr class="even">
        <td>出力オプションの指定</td>
        <td>結果を出力したい場所を指定</td>
        </tr>
        <tr class="odd">
        <td> 一覧の入力先</td>
        <td>入力した既存ワークシートのセルに結果が出力される</td>
        </tr>
        <tr class="even">
        <td> 新規ワークシート</td>
        <td>出力用の新しいワークシートが自動で作成される</td>
        </tr>
        <tr class="odd">
        <td> 新規ブック</td>
        <td>出力用の新しいExcelブックが自動で作成される</td>
        </tr>
        </tbody>
        </table>
        <p><img src="fig_dataintro_linreg.png" /></p>
        <p>正しく入力されていれば、出力オプションで指定したセルに結果が出力されます。</p>
        <p><img src="fig_dataintro_linregrsl.png" /></p>
        <table>
        <colgroup>
        <col style="width: 19%" />
        <col style="width: 25%" />
        <col style="width: 55%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>区分</th>
        <th>項目</th>
        <th>説明</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td>概要</td>
        <td>重相関 <span class="math inline">\(R\)</span></td>
        <td>説明変数と被説明変数の相関係数（複数の<span
        class="math inline">\(X\)</span>がある場合でもまとめた指標）</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>決定係数 <span class="math inline">\(R^2\)</span></td>
        <td>回帰式によって説明される<span
        class="math inline">\(Y\)</span>の変動の割合（決定係数）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td>補正 <span class="math inline">\(R^2\)</span></td>
        <td>自由度調整済み決定係数（説明変数が多いと過大評価になるのを補正）</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>標準誤差</td>
        <td>推定誤差の標準偏差（残差のばらつきの尺度）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td>観測数</td>
        <td>データのサンプル数（行数）</td>
        </tr>
        <tr class="even">
        <td>分散分析</td>
        <td>回帰</td>
        <td>回帰によって説明される分散に関する統計量（自由度,
        分散など）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td>残差</td>
        <td>説明できなかった残差の分散</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>合計</td>
        <td>総平方和（回帰+残差）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td>分散比</td>
        <td><span
        class="math inline">\(F\)</span>値の計算に用いる（回帰分散 ÷
        残差分散）</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>有意 <span class="math inline">\(F\)</span></td>
        <td>モデル全体の有意性の検定（<span
        class="math inline">\(p\)</span>値）</td>
        </tr>
        <tr class="odd">
        <td>係数表</td>
        <td>切片</td>
        <td>回帰式の切片（<span class="math inline">\(Y = \beta_{0} +
        \beta_{1}X\)</span> の <span
        class="math inline">\(\beta_{0}\)</span> 部分）</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>説明変数名</td>
        <td>各説明変数の名前（例：<code>temp</code>）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td><strong>係数</strong></td>
        <td><strong>各説明変数の回帰係数（傾き<span
        class="math inline">\(\beta_{1}\)</span>）</strong></td>
        </tr>
        <tr class="even">
        <td></td>
        <td>標準誤差</td>
        <td>各係数の標準誤差（ばらつき）</td>
        </tr>
        <tr class="odd">
        <td></td>
        <td><span class="math inline">\(t\)</span> 値</td>
        <td>係数の有意性を検定するための統計量</td>
        </tr>
        <tr class="even">
        <td></td>
        <td><strong><span
        class="math inline">\(P\)</span>値</strong></td>
        <td><strong><span class="math inline">\(t\)</span>検定の<span
        class="math inline">\(p\)</span>値。小さいほど係数が有意（例：<span
        class="math inline">\(&lt; 0.05\)</span>）</strong></td>
        </tr>
        <tr class="odd">
        <td></td>
        <td>下限 <span class="math inline">\(95\%\)</span></td>
        <td>係数の95%信頼区間の下限</td>
        </tr>
        <tr class="even">
        <td></td>
        <td>上限 <span class="math inline">\(95\%\)</span></td>
        <td>係数の95%信頼区間の上限</td>
        </tr>
        </tbody>
        </table>
        <p>たくさんの数値が出てきますが、<strong>重要なのは係数と<span
        class="math inline">\(P\)</span> 値</strong>です。</p>
        <p>係数は各説明変数の回帰係数（ここでは<span
        class="math inline">\(\beta_{1}\)</span>）を表します。
        回帰係数が<span
        class="math inline">\(-11.28\)</span>であるということは、気温（<code>temp</code>）が一度上がると売上（<code>sales</code>）は<span
        class="math inline">\(-11.28\)</span>円変化する、つまり、<strong>気温が一度上昇すると売上は<span
        class="math inline">\(11.28\)</span>円下がる</strong>という関係になっていることが分かります。</p>
        <p>一方、<span class="math inline">\(P\)</span>
        値はその回帰係数が統計的に<span
        class="math inline">\(0\)</span>と異なると言えるかどうかを示します。</p>
        <p>これは、<strong>回帰係数が<span
        class="math inline">\(0\)</span>である</strong>という帰無仮説に対する検定を行っていることを意味します。</p>
        <p>説明変数が被説明変数の予測に有効であるためには、<strong>対応する回帰係数が<span
        class="math inline">\(0\)</span>ではない</strong>、つまり<strong>統計的に有意</strong>である必要があります。</p>
        <p>そのため、回帰分析を行う際は、<a
        href="#仮説検定">仮説検定</a>で学んだ考え方に基づき、回帰係数が統計的に<span
        class="math inline">\(0\)</span>と異なることを判断するのが一般的です。</p>
        <p>詳しくは、<a
        href="#excelで仮説検定t検定をする">Excelで仮説検定（t検定）をする</a>を参照してください。</p>
        <p>分析者は、事前に有意水準を設定し、<span
        class="math inline">\(P\)</span>
        値がその水準よりも小さいときに、回帰係数は有意に<span
        class="math inline">\(0\)</span>と異なると結論付けます。</p>
        <p>例えば、有意水準を<span
        class="math inline">\(5\%\)</span>（<span
        class="math inline">\(=
        0.05\)</span>）とした場合、<code>temp</code>の回帰係数について<span
        class="math inline">\(P値 = 1.96773E-75 (=
        1.96773×\frac{1}{10^{75}}) &lt; 0.05\)</span>
        なので、<code>temp</code>の回帰係数は有意に<span
        class="math inline">\(0\)</span>と異なると言えます。</p>
        <p>よって、<code>temp</code>は<code>sales</code>の予測に有効な説明変数だと判断され、以下のような回帰式を使って売上を予測できます。</p>
        <p><span class="math display">\[
        sales = 647.2523251 -11.28513304 \times temp
        \]</span></p>
        <p>このに、実際の気温の値を代入することで、その日の売上を予測することができます。</p>
        <p>例えば、気温が22度のとき、売上金額は<span
        class="math inline">\(647.2523251 -11.28513304 \times
        22=398.97939822\)</span>円であると予測できます。</p>
        <h3
        id="ダミー変数を使った線形回帰">ダミー変数を使った線形回帰</h3>
        <p>先ほどの例では、<code>temp</code>のような<strong>連続変数</strong>（ある値と次の値の間に無限の中間値を持つ変数）を説明変数とする回帰分析を扱いました。</p>
        <p>しかし、実際の分析では、性別や職種など、数値ではないカテゴリ変数を扱う場面も多くあります。
        <a
        href="#仮説検定">仮説検定</a>の例のように、男女間での売上金額の差を分析したいような場合です。</p>
        <p>このようなときは、<strong>各カテゴリに数値を対応させることで、それを説明変数として回帰式に組み込むことができます</strong>。
        例えば、性別を男性<span
        class="math inline">\(=1\)</span>、女性<span
        class="math inline">\(=0\)</span>のように変換します。</p>
        <p>特に、0と1の<strong>2値しかとらない変数</strong>を<strong>ダミー変数</strong>と呼びます。</p>
        <h4 id="ダミー変数の係数の解釈">ダミー変数の係数の解釈</h4>
        <p>ダミー変数を回帰式に入れると、その<strong>係数は基準となるカテゴリ（0が割り当てられたカテゴリ）との差を表す</strong>ようになります。</p>
        <p>例えば、男性<span
        class="math inline">\(=1\)</span>、女性<span
        class="math inline">\(=0\)</span>をとるような<code>male</code>変数を考えると、</p>
        <p><span class="math display">\[
        sales = \beta_{0} + \beta_{1} \times male + \varepsilon
        \]</span></p>
        <p>というモデルでは、</p>
        <ul>
        <li><code>male</code><span class="math inline">\(=
        1\)</span>のとき（男性）、予測される<code>sales</code>の値は<span
        class="math inline">\(\beta_{0} + \beta_{1}\)</span></li>
        <li><code>male</code><span class="math inline">\(=
        0\)</span>のとき（女性）、予測される<code>sales</code>の値は<span
        class="math inline">\(\beta_{0}\)</span></li>
        </ul>
        <p>となり、<span
        class="math inline">\(\beta_{1}\)</span>は<strong>男性と女性の平均的な差</strong>（男性の売上金額は女性と比較して平均的に<span
        class="math inline">\(\beta_{1}\)</span>円異なる）を示す係数になります。</p>
        <p>このように、ダミー変数の係数は基準カテゴリとの比較として解釈します。</p>
        <h4 id="excelでダミー変数を作る">Excelでダミー変数を作る</h4>
        <p><span class="math inline">\(\{男, 男, 男, 女, 女, 男,
        ...\}\)</span>のように文字列でデータが入力されている場合、各カテゴリに数値を割り当て、男性<span
        class="math inline">\(=1\)</span>、女性<span
        class="math inline">\(=0\)</span>となるようなダミー変数を作ります。</p>
        <p>Excelでは<code>IF</code>関数を使います。</p>
        <h5 id="if関数"><code>IF</code>関数</h5>
        <p><code>IF(条件, 真の場合の値, 偽の場合の値)</code></p>
        <p>（例）<code>gender</code>変数が<code>男</code>のときに<span
        class="math inline">\(1\)</span>、<code>女</code>のときに<span
        class="math inline">\(0\)</span>を割り当てる:
        <code>IF(A2="男", 1, 0)</code></p>
        <p><img src="fig_dataintro_dummy.png" /></p>
        <p>このようにカテゴリと数値を対応させることで、連続変数と同じように回帰分析ができるようになります。</p>
        <p><img src="fig_dataintro_linreg_dum.png" /></p>
        <p><img src="fig_dataintro_linregrsl_dum.png" /></p>
        <p><code>male</code>の回帰係数は<span
        class="math inline">\(30.15\)</span>、<span
        class="math inline">\(P\)</span>値は<span
        class="math inline">\(9.84E-10 (= 9.84×\frac{1}{10^{10}}) &lt;
        0.05\)</span>なので、性別ダミーは売上予測に有効な変数であり、以下のような回帰式を使って売上を予測できます。</p>
        <p><span class="math display">\[
        sales = 407.963 +30.15132275 \times male
        \]</span></p>
        <p>これにより、客が男性のとき（<code>male</code><span
        class="math inline">\(= 1\)</span>）の売上金額の予測値は<span
        class="math inline">\(407.963
        +30.15132275=438.11432275\)</span>円、客が女性のとき（<code>male</code><span
        class="math inline">\(= 0\)</span>）の売上金額の予測値は<span
        class="math inline">\(407.963\)</span>円になります。</p>
        <h3 id="重回帰分析">重回帰分析</h3>
        <p>これまでは、説明変数が1つだけのケースを考えてきました。</p>
        <p>売上金額が気温によって変化するのは、恐らく寒いときに温かいものが食べたくなることが理由の1つでしょう。</p>
        <p>しかし、売上金額が変化する要因はほかにも考えられます。</p>
        <ul>
        <li>男性の方が女性よりもたくさん食べるので、売上金額は大きくなるかもしれない（実際に、性別ダミーは正に有意だったので、予測に有効な変数であることが分かりました）。</li>
        <li>学生よりも職員の方が予算が潤沢なので、売上金額は大きくなるかもしれない。
        <ul>
        <li>逆に、学生の方が食べ盛りなので、売上金額は大きくなるかもしれない。</li>
        </ul></li>
        <li>学食で割引キャンペーンなどの施策を行っている日は、売上金額は大きくなるかもしれない。</li>
        </ul>
        <p>このように、考えようと思えば、いくらでも売上金額と相関していそうな要因を挙げることができます。</p>
        <p>ここでは、2つ以上の説明変数を用いて売上金額を予測していきます。</p>
        <p>2つ以上の説明変数を使った線形回帰のことを、重回帰分析と呼びます。</p>
        <p>例えば、売上金額（<code>sales</code>）が気温（<code>temp</code>）と職位（<code>position</code>）によって予測されるモデルを仮定します。</p>
        <p>現在職位（<code>position</code>）変数は文字列のデータになっているので、先ほどの性別ダミーと同様に、学生<span
        class="math inline">\(=1\)</span>、職員<span
        class="math inline">\(=0\)</span>となるようなダミー変数を作っておきましょう（<code>student</code>変数とします）。</p>
        <p><img src="fig_dataintro_mulreg_dum.png" /></p>
        <p>このとき、売上金額は以下の式で表すことができます。</p>
        <p><span class="math display">\[
        sales = \beta_{0} + \beta_{1} \times temp + \beta_{2} \times
        student + \varepsilon \qquad \text{（1）}
        \]</span></p>
        <p>回帰式を一般的な形式に書き直すと、重回帰分析は<span
        class="math inline">\(d\)</span>（<span
        class="math inline">\(\geq 2\)</span>）個の説明変数<span
        class="math inline">\(X\)</span>を用い、以下の回帰式の回帰係数
        <span class="math inline">\((\beta_{0}, \beta_{1}, \beta_{2},
        \dots, \beta_{d})\)</span> を求める手法だと言えます。</p>
        <p><span class="math display">\[
        Y = \beta_{0} + \beta_{1} X_{1} + \beta_{2} X_{2} + \cdots +
        \beta_{d} X_{d} + \varepsilon
        \]</span></p>
        <p>このとき、重回帰分析のOLS推定量は、以下のMSEを最小化する
        <span class="math inline">\((\beta_{0}, \beta_{1}, \beta_{2},
        \dots, \beta_{d})\)</span>
        の値として定義されます（具体的な関数形は省略します）。</p>
        <p><span class="math display">\[
        MSE = \frac{1}{n}\sum_{i=1}^{n}(Y_{i} - \beta_{0} - \beta_{1}
        X_{1i} - \beta_{2} X_{2i} - \cdots - \beta_{di} X_{di})
        \]</span></p>
        <p>回帰係数を求めるには、<a
        href="#2-分析ツールを使う">分析ツールを使う</a>の方法を使います。</p>
        <p>（1）式を分析するときの例では、以下のように必要な項目を入力します。</p>
        <ol type="1">
        <li>「データ」タブ→「データ分析」の順に選択して分析ツールを開く</li>
        <li>「回帰分析」を選択</li>
        <li>必要な項目を入力</li>
        </ol>
        <table>
        <colgroup>
        <col style="width: 31%" />
        <col style="width: 68%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>項目</th>
        <th>内容</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td>入力<span class="math inline">\(Y\)</span>範囲</td>
        <td><code>sales</code>変数のデータ範囲を入力</td>
        </tr>
        <tr class="even">
        <td>入力<span class="math inline">\(X\)</span>範囲</td>
        <td><code>temp</code>変数と<code>student</code>変数のデータ範囲を入力</td>
        </tr>
        <tr class="odd">
        <td>ラベルの指定</td>
        <td>1行目に変数名がある場合、「ラベル」にチェックを入れる</td>
        </tr>
        <tr class="even">
        <td>出力オプションの指定</td>
        <td>結果を出力したい場所を指定</td>
        </tr>
        <tr class="odd">
        <td> 一覧の入力先</td>
        <td>入力した既存ワークシートのセルに結果が出力される</td>
        </tr>
        <tr class="even">
        <td> 新規ワークシート</td>
        <td>出力用の新しいワークシートが自動で作成される</td>
        </tr>
        <tr class="odd">
        <td> 新規ブック</td>
        <td>出力用の新しいExcelブックが自動で作成される</td>
        </tr>
        </tbody>
        </table>
        <p><img src="fig_dataintro_mulreg.png" /></p>
        <p>正しく入力されていれば、出力オプションで指定したセルに結果が出力されます。</p>
        <p><img src="fig_dataintro_mulregrsl.png" /></p>
        <p>ここでも、<strong>係数</strong>と<strong>p値</strong>に注目します。</p>
        <p><code>student</code>変数の係数は<span
        class="math inline">\(-3.86\)</span>、p値は<span
        class="math inline">\(0.44\)</span>です。</p>
        <p>ダミー変数の係数は基準カテゴリとの比較だと解釈できます。ここでは、職員（<code>student</code><span
        class="math inline">\(=0\)</span>）と比較して、学生（<code>student</code><span
        class="math inline">\(=1\)</span>）は<span
        class="math inline">\(3.86\)</span>円平均購入金額が低いということを示しています。</p>
        <p>ただし、p値が<span
        class="math inline">\(0.44\)</span>と有意水準の<span
        class="math inline">\(0.05\)</span>より大きいため、これは統計的に有意ではないと判断されます。</p>
        <p>ちなみに、重回帰分析のパラメターは、<strong>他の条件を一定にしたもとで、その説明変数が1単位変化したときの被説明変数の平均的な変化の大きさ</strong>を表します。</p>
        <p>したがって、<code>student</code>変数の係数は、気温（<code>temp</code>）を一定にしたときに（気温が同じであれば）、職員と学生を比較したときに、学生の方が平均購入金額が<span
        class="math inline">\(-3.86\)</span>円高い（つまり、<span
        class="math inline">\(3.86\)</span>円低い）と解釈できます。</p>
        <p><code>temp</code>変数の係数は<span
        class="math inline">\(-11.3\)</span>、p値は<span
        class="math inline">\(2.07\times
        10^{-75}\)</span>です。これは<code>student</code>変数を一定としたときに（学生同士、職員同士で比較した場合）、気温が1度上がると平均購入金額は<span
        class="math inline">\(-11.3\)</span>円増加する（温が1度上がると平均購入金額は<span
        class="math inline">\(11.3\)</span>円減少する）ことを示しています。この係数のp値は非常に小さいため、統計的に有意であると判断できます。</p>
        <p>このように、重回帰分析を用いると、複数の説明変数を同時に用いた予測を行うことができます。</p>
        <p>実際の社会では、ある事柄が1つの要因だけで説明できることはほとんどありません。何かを予測・説明したい場合には、複数の関連しそうな変数を考慮し、それらのデータを収集する必要があります。</p>
        <p>ただし、やみくもに説明変数を増やせばよいというものではありません。</p>
        <p><strong>説明変数同士の相関が強すぎると多重共線性</strong>（multicollinearity）の問題が生じる可能性がありますし、<strong>説明変数の数が多すぎると過学習</strong>（overfitting）を引き起こすリスクもあります。
        説明変数は、<strong>分析の目的やデータの特性、統計的な妥当性を考慮して選択する</strong>必要があります。</p>
        <h3 id="決定係数">決定係数</h3>
        <p>最小二乗法の推定量は線形回帰式のMSEを最小にするように回帰係数を求めます。ただし、すべての観測値を完全に予測することはできません。</p>
        <ul>
        <li>誤差の二乗和</li>
        </ul>
        <p><span class="math display">\[
        \sum_{i=1}^{n} \varepsilon_{i}^{2} = \sum_{i=1}^{n} (Y_{i} -
        \beta_{0} - \beta_{1} X_{i})^{2}
        \]</span></p>
        <p>必ず誤差が生じるのであれば、私たちは<strong>求めた回帰式がどの程度データの動きを説明してくれているか</strong>知りたくなります。</p>
        <p>もし<strong>回帰式がデータをうまく説明してくれているのであれば、誤差の二乗和は十分小さくなっているはず</strong>です。</p>
        <p>しかし、誤差の二乗和は0以上の値をすべての観測値について足し合わせたものなので、<strong>サンプルサイズが大きくなると、誤差の二乗和も自動的に大きくなってしまいます</strong>。</p>
        <p>そこで、サンプルサイズに依存しない形で回帰式の当てはまりの良さを評価する指標として用いられるのが<strong>決定係数</strong>（<span
        class="math inline">\(R^{2}\)</span>）です。</p>
        <p>決定係数は、<strong>被説明変数のばらつき（総変動）のうち、どれだけの割合が誤差の二乗和（残差変動）によるものなのかを表す比率</strong>に基づいて計算されます：</p>
        <p><span class="math display">\[
        R^{2} = 1 - \frac{\text{残差変動}}{\text{総変動}} = 1 -
        \frac{\sum_{i=1}^{n} \varepsilon_{i}^{2}}{\sum_{i=1}^{n} (Y_{i}
        - \bar{Y})^{2}}
        \]</span></p>
        <p>決定係数は<strong>0から1までの値をとり</strong>、<strong>1に近いほど回帰式はデータへの当てはまりが良い</strong>ことを示します。</p>
        <ul>
        <li><span
        class="math inline">\(R^{2}=1\)</span>のとき：回帰式が完璧にデータを説明しており、残差変動は0</li>
        <li><span
        class="math inline">\(R^{2}=0\)</span>のとき：回帰式が全くデータを説明できておらず、残差変動と総変動が等しい</li>
        </ul>
        <p>このように、決定係数は回帰モデルの説明力を直感的に把握するための有用な指標です。</p>
        <p><img src="fig_dataintro_linregrsl.png" /></p>
        <p>購入金額を気温に回帰したときの結果を振り返ってみます。 重決定
        R2 という項目が決定係数 <span
        class="math inline">\(R^{2}\)</span> です。</p>
        <p><span class="math inline">\(R^{2}=0.484\)</span>
        なので、総変動の<span
        class="math inline">\(48\%\)</span>が説明変数によって説明されており、残りの<span
        class="math inline">\(52\%\)</span>は他の要因によって説明されていると解釈できます。</p>
        <p>一般的に決定係数が<span
        class="math inline">\(0.5\)</span>以上の場合はある程度データへの当てはまりが良いと言われるので、今回はあまり当てはまりの良くないモデルであると言えるでしょう。</p>
        <p>重回帰分析でもデータへの当てはまりの良さを表す指標として決定係数
        <span class="math inline">\(R^{2}\)</span>
        をそのまま使うことができます。</p>
        <p>しかし、<strong>定義上説明変数の個数が多くなるほど決定係数
        <span class="math inline">\(R^{2}\)</span>
        は大きくなってしまいます。</strong></p>
        <p>そこで、重回帰分析の場合は、<strong>説明変数の個数を考慮した自由度調整済み決定係数</strong>
        <span class="math inline">\(R^{2}\)</span> 用います。
        Excelの分析結果では、補正 R2 という項目で出力されます。</p>
        <p><img src="fig_dataintro_mulregrsl.png" /></p>
        <p>購入金額を気温と学生ダミーに回帰した分析結果を振り返ってみると、重決定
        R2<span class="math inline">\(=0.485\)</span>、 補正 R2<span
        class="math inline">\(=0.483\)</span>でした。今回は2つの決定係数にほとんど差はありませんが、説明変数の個数が増えると両者は乖離してしまうため、その場合は自由度調整済み決定係数を用いて適切なモデル評価をすることが求められます。</p>
        <h4 id="決定係数の注意点">決定係数の注意点</h4>
        <p>回帰式の当てはまりの良さを評価できる決定係数ですが、あくまでも<strong>当てはまりの良さ（予測の正確性）を評価する指標</strong>であって、必ずしも<strong>回帰式そのものが正しいことや妥当であることを保証するものではない</strong>、ということに注意が必要です。</p>
        <p>例えば、サイコロを100回振ったときの出目（1〜6）を記録し、それを説明変数として「次に出る目」を予測する回帰モデルを作ったとします。訓練データには、例えば「直前に1と6が続いたら次は3が出やすい」など、偶然のパターンが現れることがあり、回帰式の当てはまり（<span
        class="math inline">\(R^2\)</span>）が高くなるかもしれません。</p>
        <p>しかし、サイコロは毎回の出目がランダムに決まり、前の出目とはまったく関係がありません。つまり、「前に何が出たか」は「次に何が出るか」に影響しないのです。そのため、どれだけうまく過去のデータに当てはまる回帰式を作っても、サイコロの次の出目を予測することはそもそも不可能であり、サイコロの出目を他のサイコロの出目で予測すること自体が無意味なことです。</p>
        <p>他にも、例えばテストの点数から勉強時間を予測することを考えてみましょう。このときの回帰式は次のようになります。</p>
        <p><span class="math display">\[
        study = \beta_{0} + \beta_{1} \times score + \varepsilon
        \]</span></p>
        <p>このとき、決定係数は高い値を示すかもしれませんし、例えば「点数が80点の生徒は平均して3時間勉強している」といった傾向が見られることもあるでしょう。</p>
        <p>しかし、実際にはテストの点数が勉強時間を決めるのではなく、勉強時間がテストの点数に影響すると考えるのが自然です。つまり、因果の向きが逆であり、この回帰式を使って勉強時間を予測するのは不適切です。</p>
        <p>このように、たとえ説明変数と被説明変数間に有意な相関があり、決定係数が高い回帰式であったとしても、</p>
        <ul>
        <li><strong>説明変数が被説明変数に影響を与えているとは限らない</strong></li>
        <li><strong>その回帰式が予測に適しているとは限らない</strong></li>
        </ul>
        <p>という点には注意が必要です。</p>
        <h3
        id="回帰分析では因果は分からない">回帰分析では因果は分からない</h3>
        <p>さらに、<strong>回帰分析の結果を因果関係と解釈してしまうことにも注意が必要</strong>です。</p>
        <p>回帰分析では、被説明変数と説明変数の関係が、<strong>一緒に増える・片方が増えるともう一方は減ると</strong>いった形で現れます。</p>
        <p>このような関係が見られると<strong>説明変数が被説明変数の原因なんだと思いたくなるかもしれません</strong>。</p>
        <p>しかし、<strong>回帰分析に出てきた関係は、あくまで一緒に変化しているだけ</strong>であって、<strong>どちらかが原因で、どちらかが結果だということは示していません</strong>。</p>
        <p>例えば、先ほどのテストの点数と勉強時間のケースを考えると、テストの点数と勉強時間に強い相関があったとしても、点数が高いから勉強しているのか、勉強しているから点数が高いのかは、回帰式だけでは判断できません。</p>
        <p>また、<strong>別の隠れた要因</strong>（例えば体調や家庭環境など）<strong>が、両方に影響している可能性もあります</strong>。
        このような場合、<strong>見かけ上は相関があるように見えても、実際には因果関係はない</strong>ということも往々にして起こり得ます。</p>
        <p>したがって、回帰分析の結果を解釈するときは、<strong>これは原因と結果の関係なのか</strong>？****ほかの要因はないのか<strong>？といった視点を持ち、</strong>データだけではなく文脈や常識も含めて慎重に判断することが大切**です。</p>
        </details>
        <h1 id="因果推論">因果推論</h1>
        <details>
        <summary>
        因果推論セクションを見る（クリックで開閉）
        </summary>
        <p><a
        href="#回帰分析">回帰分析</a>では、売上金額を気温や性別、職種といった変数を使って予測する手法を学びました。回帰分析は、ある条件のもとで平均的にどのくらいの売上が期待できるかを予測するためのツールです。</p>
        <p>しかし、私たちが知りたいのは、必ずしも今ある条件での予測だけとは限りません。</p>
        <p>例えば、特定の商品の広告を出したら売上は増えるのか？新しいポイント制を導入したら購買行動が変わるのか？
        こういった、何かを変えたときに結果はどう変わるのかという問いに答えたい場面が考えられます。</p>
        <p>こうした問いに対して、単なる回帰分析で答えることはできません。
        必要なのは、変数間の相関ではなく、因果関係（原因と結果の関係）を推定する方法です。</p>
        <p>この章では、変数間の因果を推定する方法（因果推論）を学びます。</p>
        <h2 id="因果関係とは">因果関係とは</h2>
        <p>まずは、<strong>そもそも因果関係とは何か</strong>？をきちんと定義し、<strong>相関はあるが因果関係はない</strong>ケースを考えていきます。</p>
        <p><strong>因果関係</strong>とは、<strong>2つの変数のうち、どちらかが原因で、どちらかが結果となる関係のこと</strong>です。</p>
        <p>これに対して、<strong>相関関係</strong>とは、<strong>2つの変数が一緒に変化する傾向はあるものの、一方が他方の原因であるとは限らない関係のこと</strong>です。</p>
        <p><img src="fig_dataintro_causal.png" /></p>
        <p>一般に、両者の関係を区別することは容易ではありません。</p>
        <p>なぜなら、どちらの関係であったとしても、2つの変数は連動して動いて見えるからです。</p>
        <p>実際は相関関係であるのに、それを因果関係と混同してしまうと、期待した結果を得られません。</p>
        <p>例えば、学食の利用状況に関するデータを分析し、次のような相関関係が見つかったとします。</p>
        <blockquote>
        <p><strong>食堂で長時間滞在する学生ほど、1回あたりの売上が高い。</strong></p>
        </blockquote>
        <p>この結果を受けて、大学は「学食の売上を伸ばすには、学生の滞在時間を長くすればよい」と考え、<strong>学食にWi-Fiや電源を整備し、長居しやすい空間づくりに投資</strong>するかもしれません。</p>
        <p>ところが、施策実施後、期待されたほど売上は伸びず、むしろ<strong>席が埋まりやすくなり、回転率が下がって全体の売上が減少</strong>してしまう可能性もあります。</p>
        <p>このような結果を招く要因は、<strong>滞在時間が長い人は売上が高い</strong>という相関関係（単なる傾向）を、<strong>因果関係と勘違いしてしまったこと</strong>です。</p>
        <p>実際には、</p>
        <ul>
        <li><strong>友人と一緒に来る学生</strong>はもともと長居しがちで、複数人分まとめて会計するために単価が高くなっていた</li>
        <li><strong>昼休みなどの混雑時間帯を避けて来る学生</strong>が、空いている時間にゆっくり食べることができるため、滞在時間が長く購入金額が高めだった</li>
        <li><strong>空きコマの時間帯に来る学生</strong>が長居・高単価な傾向にあった</li>
        </ul>
        <p>といったように、滞在時間の長さ自体が売上の原因ではなかった可能性があります。</p>
        <p>したがって、<strong>相関があるからといって因果関係があるとは限らない</strong>ことを理解しないと、本来の目的（売上向上）に反する結果を招くことすらあります。</p>
        <p>より良い結果を得るために、お金や時間を効率的に使うには、<strong>因果関係に基づいた判断</strong>、<strong>つまり因果推論</strong>が必要となるのです。</p>
        <h2 id="相関と因果の違い">相関と因果の違い</h2>
        <p>データからは「滞在時間が長い学生ほど、1回あたりの売上が高い」という相関関係が見いだせましたが、滞在時間を長くさせる施策は失敗に終わりました。</p>
        <p>それは、滞在時間が売上の原因ではなかったからです。</p>
        <p>それでは、相関関係は成り立っても因果関係は成り立たない要因とは何でしょうか？</p>
        <p>この問いを考えるために、ここでは因果関係を見極めるための考え方について解説します。</p>
        <p>相関が因果を示さない理由は、主に以下の3つです。</p>
        <h4 id="偶然たまたま">1. 偶然（たまたま）</h4>
        <p>2つの変数の動きが似ているのは、<strong>たまたまそうなっただけ</strong>かもしれません。</p>
        <p>たとえば、ある日「学食の売上が高く、同時に図書館の利用者も多かった」としても、それが直接関係しているとは限りません。偶然の一致である可能性は常に考慮する必要があります。</p>
        <h4 id="疑似相関交絡因子の存在">2.
        疑似相関（交絡因子の存在）</h4>
        <p><strong>2つの変数に直接の因果関係がなくても、共通の第三の要因が存在する場合</strong>、見かけ上の相関が生じることがあります。</p>
        <p>これを<strong>疑似相関</strong>と呼びます。</p>
        <p>例： &gt; 滞在時間が長い学生ほど売上が高い</p>
        <p>この状況は、次のようなメカニズムによって生じているかもしれません。</p>
        <ul>
        <li><strong>友人と来ているため、長居しやすく、注文も多くなっている</strong></li>
        <li><strong>混雑を避けて空いている時間に来ており、時間的余裕から注文数も多い</strong></li>
        <li><strong>昼休み後の空きコマに来る学生は、追加メニューを頼む余裕がある</strong></li>
        </ul>
        <p><img src="fig_dataintro_confounder.png" /></p>
        <p>このように、<strong>滞在時間と売上の両方に影響を与える第三の変数</strong>のことを<strong>交絡因子</strong>と呼びます。</p>
        <p>滞在時間と売上の間に相関が見つかったとしても、<strong>滞在時間そのものが原因とは限らない</strong>のです。</p>
        <p>この交絡因子はデータとして取れない性質のもの（例えば、人々のやる気やその日の体調、友人との関係性など）であることも多いので、手元にデータとして存在する変数だけではなく、手元には存在しない変数も含めて、交絡因子が存在していないかどうかを疑ってみることが大切です。</p>
        <h4 id="同時性逆因果">3. 同時性（逆因果）</h4>
        <p>2つの変数が<strong>お互いに影響しあっている</strong>場合、因果の向きが曖昧になることがあります。</p>
        <p>たとえば、以下のような2つの仮説を考えてみましょう。</p>
        <ul>
        <li><strong>長居しているから、飲み物やデザートを追加で購入し、売上が多くなる</strong></li>
        <li><strong>たくさん注文したから、食べきるのに時間がかかって結果的に長居になっている</strong></li>
        </ul>
        <p>どちらももっともらしく聞こえますが、因果の向きが逆になっています。</p>
        <p>このように、<strong>一方が他方に影響しているのか、それとも逆なのか</strong>、あるいは<strong>両者が同時に影響しあっているのか</strong>を慎重に検討する必要があります。</p>
        <hr />
        <p>このように、相関があっても因果関係があるとは限らず、誤った因果解釈をしてしまうと、思ったような効果が得られなかったり、逆に売上が下がってしまったりする可能性もあります。</p>
        <p>したがって、<strong>学食の売上を伸ばすにはどうすればよいか</strong>？を真剣に考えるには、<strong>因果関係に基づいた判断</strong>が不可欠です。</p>
        <p>そのために、まずは因果関係をしっかりと定義しましょう。</p>
        </details>
        <p><a href="index.html">講義資料に戻る</a></p>
    </main>
</body>
</html>
